/*
Input format:
N
Bx
Bz_0
Bz_1
...
Bz_N
J_{0,1}
J_{1,2}
...
J{n-2,n-1}
*/

#include <stdio.h>


const int N = 300;
const double Bx = 2;
// elements of Bz and J are randomly generated from uniform(-2, 2)
const double Bz[] = {-1.534323072568279, 0.6229863125924346, -0.1215860803633344, -0.2598321017449421, 0.1360586417916485, -1.9840136575462575, 1.0334408652496299, 0.2870048137789891, -0.7906846384188482, -0.8747072013668538, -1.6695093440385507, -1.9541434242424254, 0.3300809382226828, 1.644263056225582, 0.8253513395385332, -0.10455083252774955, -0.47751213439447104, 1.8336343257084953, -0.9687990429486399, 0.9618755511515835, -0.7340108041551274, 1.0775474967392906, -1.1687438639188894, 0.80501471463911, 0.15555526102493644, 1.210291647692253, -1.5747818509907159, 1.1396701244413703, -1.70035745158589, -1.4694618861464157, -0.03341196919142053, -1.483729240466574, -0.350255574504327, 0.5732767996468522, 0.7751370017390937, -0.4500071046607199, -1.2859594734949806, -0.6692640232871918, -0.9256711932809236, 0.26671519221660933, 0.553741116425936, 0.5765134914992198, -1.231234072857125, 0.1633339478706537, -0.6725006078320908, 0.66168517752814, 0.7878385689479175, 0.4375774869018003, -0.5619622307713517, 0.7006047353915852, -1.267657714500472, -1.7008820009661956, 0.9507290198217482, -1.1705420942536162, -1.198004150457617, -0.2868589638417802, -1.5738338373132752, -0.3493628208723534, -1.0763910755807986, 1.298113560251588, -1.8581973201177262, -0.627133818305369, 0.9078909511263156, -0.828359015719506, 1.4963109685534008, -1.9911757456850747, 0.8376325449048565, 1.3390369532785535, 0.48766936537887595, -1.5968765720966989, 1.9040783727023576, 0.007167128290937352, 0.9138455519832145, -1.6629914221245823, 1.4713376760415229, 1.3247608074803345, 1.0863812701657838, -0.8738670435449114, -1.4737549170836202, 0.9720477364324358, -1.393211130665144, -1.0344420952217082, -1.0022208535071186, -0.8917178537198285, -0.401782293012344, 1.0976479314810863, 1.2167721289667686, -1.0053716668954555, 0.7947693147610821, 0.47959393077980517, 1.1837008367692285, -0.9682971381017436, -1.7239215903193101, 0.21936858301386142, -1.4880782726642905, 1.3473471018917431, -1.368614187269265, -1.8827623126908843, 1.8520939800895921, 0.2824730893907903, 0.6684807880900498, -1.4510783437290642, -0.06742061636318519, -0.38537301354506814, -0.25042663608378257, 0.4564840682354543, 0.2585080489537135, 1.2580506049279285, 0.45307831648833163, 0.04713881893714378, -1.4187186603802227, 1.8812724823587557, -0.48217484130839994, -1.247870978221063, -1.901846955859924, 1.457589205240355, -0.9689421264044307, -0.21890004562915522, -1.0962912379430594, -0.5455325440233341, 0.4388823292778068, -1.3817822385200307, 1.4672092521643947, 1.1003849070223741, -0.17805356263126804, 1.3133744131046492, 0.21453416778477852, 1.6653343462329504, -0.5665757689233195, 1.0563728403631516, 1.971639711125226, -0.5561157661177742, -1.7692235348990253, 0.5512396319786976, -1.570497775905566, 0.9208485805852376, -1.2834959596908413, -1.1402826635340184, -1.0727771642058297, 1.9375741611648256, -1.6806662252225424, 1.554593628607567, 1.68321042031786, -1.331170473426377, 0.4847500251367012, -0.8817196262422606, 1.787140391138951, -0.31232042273749094, 1.2791874811558945, 0.9993405589066944, 0.022996968622290392, 0.0917789135305127, -0.7467211690739779, 0.8644756456837204, 1.1959224444001864, -1.995007288862705, 1.933252423785638, 1.1409425216406484, -0.4110917070188074, -0.4389615062162755, 1.607745752532173, -0.9009591662941379, -0.15231484632410242, -0.9554787028374139, 0.03255206418983336, -0.20270106892610062, 0.4578415102444042, 1.369446543644055, 1.4339697839682302, -1.8076616940184356, -0.11076877451786604, -0.9536292994237021, 1.1570297419325781, 1.4684455441011486, -1.7964701762483397, 1.1771235175207906, -0.9596176911882437, 1.8814678221851064, 1.4013160899686592, 0.6474540620210134, 0.699054793364223, 1.6852916616999556, -1.6165850710272545, -1.9891711770382647, 0.6245646143622046, -1.8064289328458414, 1.6999305513366636, 1.2107078748148021, -0.02837144617930676, 1.3497539205563207, 0.4437635834797278, 0.20623355851670633, 1.3805695027857996, 0.8893478669174266, 0.8647462207142222, 0.3707649956792127, 0.8014056478526843, 1.6953120604578373, 1.3553759791059399, 0.853953436447104, -1.2922749622366947, -1.7302952417032191, -0.556523176019116, 1.876701152396579, 1.3553999355618633, 0.15178657889600977, 0.7713358191364672, 0.5683065184145804, 0.3664810995642185, 0.02768711601753404, -1.00290373897348, -0.6353826444211079, -0.0037557671512002955, 0.2668790284134044, -1.4219146565115528, 0.6960654242369655, -1.5585339011236856, -1.921462291881455, 0.8992382836632733, 0.12647925248245784, -1.9451890454288878, 1.3169848671052575, -0.8188083068780858, -0.8921460359497968, -0.6007894925499886, 1.8802897201675517, -1.6014929416594512, 1.004555329718682, -1.2281334430668713, 1.3729691279803715, 0.8832779984578338, -1.0215298980281298, 0.68975387268594, -0.6734701064257904, -0.2718363700370032, 1.9890621396159927, -1.8743897033503294, -0.24768558199839452, -1.4736934366150387, 1.6570472809128654, 1.2541847207057075, -1.7836820616765867, -0.25955275734557404, -1.247736988631106, -0.48290489458793173, -0.6293300608315797, -0.28314102246546824, -0.8019017715434926, -1.1460778019482296, -0.49997996715526494, -1.5146630394767144, 0.6236420895702199, 0.8779424251402568, 0.5139262870809524, -1.2278871353685221, -0.6672274473591169, 0.9865141440942446, 0.9298902020673867, -1.4399616868807859, -0.16914001954707558, -1.7356574290169773, -1.8643537601642346, 1.05147568501487, -0.973204657633572, -1.1793428860748754, 0.6653259156769122, 0.08269329879944509, -1.9900700966333078, -0.3699154498900121, -0.9927259265076325, 1.7480134403797307, 0.24937956921120685, -0.7288031333370082, -0.1540218369082198, -0.8478158389622275, -0.7659420234702505, -0.6519248439950518, 0.533337453454874, -1.7097043928824855, 1.2972692852997736, -1.766078266099044, -1.5460640897200455, -0.7241472921375416, 0.9444654600078382, -0.7326659395235575, -1.6679358616214333, -0.01443614870102472, 0.33934887198084684, 0.07986021909593521, -0.39584991852509965, -1.797491769770803, -0.8632040063272832, 1.916682850104972, 0.6407902622789798, 0.08030225637839994, 0.888411159633999, -0.3273586460317879, 1.323951823207362, 1.5619548722115892, 0.9048837959835438};
const double J[] = {-0.6089781796880924, -0.4826896116987407, 0.10260653570329747, -0.8813998257677342, -1.3488829141868757, -0.4364050220407383, -1.8200152004699515, -1.60695807017321, -1.4065565108889282, -0.5314852394652059, 0.3947565797533894, 1.6748178011671784, -1.4079707637409604, -1.9399776287163015, -1.7240954729037417, -0.7599615242319682, -1.5528775125774752, 0.5508486952709526, 0.16395485528000675, 1.886937439058097, 1.6979450456848917, 1.5127758662362476, -1.8041080800944163, 1.139432380902556, 1.817090631044922, -0.9472607619133213, -0.142966752909242, -1.0989869149354967, -1.5066039767578676, 0.8308549941768195, -0.3767899611721117, 1.4903771294741093, -1.7139642855998352, 1.7781407086781433, 1.361912518856093, -0.664580028414012, -1.316224040547917, 0.24938297647587282, 0.6743984091229289, -1.2653159677252637, 1.1902005554745938, -0.8846233173768989, -0.9593225683143194, 0.43153096542868674, -1.4560973903056755, 1.8137291627753855, 0.697032725093707, 1.056734148112584, 0.038887715772702336, -0.6997167101134982, 1.8834218463607022, 0.9524768671917481, -0.20763398303764147, -1.5037388473178046, -1.1013000608268748, 1.0379724680620712, -1.8618027208041394, -0.5522647833041576, 1.8661926621192007, 0.027274257757051945, -0.4987088053690427, 0.4400148406037858, 0.02648677611554673, -0.2620118817722368, -0.4082730587512713, 0.6665047264601522, 1.781180174754684, -1.5909286047437718, -0.2488872761469363, -1.8349775956617274, -1.9527006729884184, 1.8097336456377522, 0.6144587902677627, 1.5446594163097993, 1.9222754810409017, -1.4788683672465277, 0.6220634291520923, -0.160092775913367, -0.428937024303484, 0.5497811262311134, 0.5517783321437295, -0.034305666762627585, 1.356983241517764, -0.655317459942296, -0.20710809918787731, -1.177850081329907, -1.4525908368809781, 1.3732280125732323, 1.919052360100126, 0.48358308000327765, -1.401873885402516, -1.8461446332704963, 0.47956301047927674, 0.07569924419459095, 1.8978866904907474, -0.2432489815649057, -1.356495278255783, -1.411023468494307, 0.46319352418427595, -0.1203471029906007, -1.2338610140033244, -1.5721603207993393, -1.2717615334798622, 1.8974557298449133, 0.4034729252524967, 1.2769049035924036, 0.19227449756813142, -1.178982189368614, 0.7979365366207767, 0.6940701238430651, 0.6752650075139126, 0.3423317717405179, 0.8036642300370191, 1.156910271435796, -0.0688398492053004, -0.17853008030997453, 1.1883842809425436, -0.5112453589413128, -0.08273747702388157, -1.761919996154143, -1.7177664574127043, 0.9783825509877677, -1.6102401097207766, -1.6496698379840744, -1.0724514550624078, -0.4960044998643598, 0.9489281978022803, 1.669589020653338, 1.5537426993491414, -0.7146774873307766, 0.31923102375620527, -1.2398996314169692, -1.5163392893673802, -0.36609375257589205, 1.681965164970101, 1.9301281687144907, 1.9727676112776655, -1.450216726272033, 1.6899535086152668, 0.12577117765607726, 0.2986572360510076, 1.1276227238400498, -0.21754765511240093, 0.8905190723347323, -1.2478558524883328, -1.039352687500029, -1.7671519206299116, 0.009517005141758794, -0.8058089703470119, -1.1871020513371215, 1.5652253465589165, -0.3882208513569907, 0.9494002226891856, -1.16697045745203, 0.8716299273617341, 0.28832465207237234, 0.34803203795173676, -0.01764717145675032, 1.2226663497515542, 1.3240834251508047, -1.8235755177781652, 0.4464325447900679, 1.1145614533763295, 1.6637993928634662, 1.566274600011345, 1.5129129343666095, 1.6654908946304832, -1.7278299024472386, -1.6966766095093453, 0.5303532653924852, -1.2212301227536928, 0.7779265106875308, 1.8827976620347058, -0.17756381635857288, -1.0196884020552899, -1.011550237187818, -0.7792826349039523, -0.75587376143628, -0.29032084854287676, -1.4015207230151168, 0.6337818333719394, 1.9836127482701906, -0.05269534133698883, 1.3763753287605756, 1.159252426378739, -1.8516261585659746, -0.25088467870371334, -0.7831641354159964, -1.9474048586253327, 1.5211142887865363, 0.8827813627500927, -1.6079601561812025, 1.8101520550789787, -0.04631276788509142, -1.8042843480843267, -1.2649215368702937, -1.2169962075295384, 0.2731146737394834, -0.9925334286196885, -1.5504178230369408, -1.8971954418313994, 0.9326616942747346, 1.9156098554958998, -0.44050799218209713, 1.2872737753122694, -1.331212007979834, 1.702987480918574, -0.8735331158077435, 1.9957231394018504, 1.4119810155472359, 1.1149724803463212, 0.23036251539281505, -0.07437373864429464, 1.4403658403771025, 1.3232271414162797, 0.1723183388539704, -0.07590174816864215, -0.482648791518967, -0.5831200997800852, 1.3002899771722776, 0.01386759198497689, 1.135585895913568, -0.9870281873414792, -0.08101791182421225, 1.8878230632685735, -0.35183036973678306, 1.5371635448978815, 1.9664689815319503, 0.7442658568245029, -0.8534030915297768, 0.08084096201572333, -0.5515611663012434, 1.3531617998862253, -1.24177008845977, 1.2319147301118223, 1.6199884248220084, 0.8410120626605684, 0.352450854519601, -0.2502097007162609, -0.0186914289724589, 1.2799708223975466, -1.1633916361295995, 1.2151147814739502, -0.6751038768228828, -1.1962660942179797, -1.5770141823474608, -0.40471599818623183, -1.753309929029867, -0.8329749489346248, 1.1575166935412677, -0.7311412083080948, 0.6552645446276384, -0.9691416434673186, -0.7292438084358586, -1.727942640539255, -1.772248028453479, 1.2829485571503327, 0.29111948788253317, 0.23050339619452842, 0.9980807602112196, -0.40756155866901134, -1.7821345170010483, -0.0630320984569166, -0.7891815207931434, -1.1997065690810755, 0.8213484485144864, 1.6359243377963808, -1.9638670637237596, -0.5414700043195824, 1.0114088097843723, -1.0316435272405777, -0.39826307969588637, -1.9818313349962082, -1.6460795739399834, -0.6643750054182775, 0.4457489148057645, 0.5324705977315309, 0.7505556012625259, 1.0691109314114935, -1.0909276781907398, -1.3650932799814766, -0.6449741610763673, 1.9485806481559105, 1.8895440372157952, 0.4222940664812649, -0.5102551621869704, -1.6800526582182989, -1.529545233403537, -1.3027149639230302, -0.6877308743397554, 1.8986253190134024, -1.0781462515144407, 1.1137374503374469, -0.7486486419833964, 1.926072815180508, -0.3396158390781463, -0.017819476811465673, 1.6146551703609449, 1.6222314626933145};

void CZ(qbit q1, qbit q2, double phi) {
    // printf("performing Controlled -2phi Z rotation\n");
    Rz(q2, -2.0*phi);
    CNOT(q1, q2);
    Rz(q2, phi);
    CNOT(q1, q2);
}

void ZcrossZ(qbit q1, qbit q2, double phi) {
    // printf("performing sigma_z cross sigma_z Hamiltonian\n");
    Rz(q1, phi);
    Rz(q2, -phi);
    CZ(q1, q2, -2.0*phi);
}


int main() {
    qbit reg[N];

    // Initialize all qubits to |+> state
    int n;
    for(n=0; n < N; n++) {
        PrepZ(reg[n], 0);
        H(reg[n]);
    }

    double T = 15;  // total duration of adiabatic evolution
    int M = 25;  // number of Trotter steps
    double dt = M / T;  // time per Trotter step

    int m;
    for(m = 1; m <= M; m++) {

        // Z-Z hamiltonian, executed in parallel
        for (n = 0; n < N-1; n += 2) {  // red pairs
            double phi = J[n] * (2.0*m - 1) / M;
            ZcrossZ(reg[n], reg[n + 1], phi);
        }
        for (n = 1; n < N-1; n += 2) {  // black pairs
            double phi = J[n] * (2.0*m - 1) / M;
            ZcrossZ(reg[n], reg[n + 1], phi);
        }

        double theta1 = (1.0 - (2.0*m-1)/M) * -2 * Bx * T / M;
        for (n = 0; n < N; n++) {
            H(reg[n]);
            Rz(reg[n], theta1);
            H(reg[n]);
        }

        // Bz hamiltonian
        for (n = 0; n < N; n++) {
            double theta2 = (1.0 - (2.0*m-1)/M) * -2 * Bz[n] * T / M;
            Rz(reg[n], theta2);
        }
    }


    for (n = 0; n < N; n++) {
        MeasZ(reg[0]);
    }
    
    return 0;
}
