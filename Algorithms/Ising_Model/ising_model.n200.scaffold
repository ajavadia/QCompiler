/*
Input format:
N
Bx
Bz_0
Bz_1
...
Bz_N
J_{0,1}
J_{1,2}
...
J{n-2,n-1}
*/

#include <stdio.h>


const int N = 200;
const double Bx = 2;
// elements of Bz and J are randomly generated from uniform(-2, 2)
const double Bz[] = {1.7170998326885476, 1.5182416960440155, -0.3526555043203623, -1.3757968302065446, 1.6010619614758577, 1.6778426467118588, 0.7245808464690358, -0.6445868366186409, -1.1273234537276426, 0.18428570582621795, -1.41160079982871, -1.7375805179244845, -1.7140160933182504, -0.6179369650076922, 1.4390501829715059, 0.520020995956731, 1.088027190027018, -0.28385139395754155, -0.8517116550893791, -0.020633539439280035, 0.14181664682534167, -1.5885187011480406, 0.33660559120894984, -0.2041456552865344, 1.6672650828631697, 1.752503053732291, 1.973125634321097, -1.982115409018797, 0.1895203085911965, 0.35090134005721874, 1.0123057540478149, -1.6847034578785975, -1.7655646264984548, 0.5035748287732624, 1.8466169575320581, -0.7172998075432937, 0.6480887084816889, -1.5354576440303336, -0.2387473196011527, -1.1473734038020158, 0.4393111086811934, -0.6031252434895946, -0.14916172996974453, 1.7722539451758812, 0.3253500113921146, 1.081011136459427, -1.6749926307808174, -0.2626488206574904, -1.4119339465114353, 0.2973205192218127, -1.2413834027472075, 1.5875932535179582, -1.6384655115329494, -0.749328918937104, -0.3373998806362004, 0.4019999528821172, 1.6548146986044876, 1.2741676244710973, 0.8692845840721066, -1.0500767077382673, 0.13209328343896853, -0.8079930919263689, 0.9539243369043304, 1.5149112143342465, 1.2729765476829025, 1.1142341172198793, 0.02651097358579868, -1.6996658738547308, 0.06416343675437464, 1.29564927806726, 1.80406435955067, 1.392911256101284, -0.892144288942402, 1.8431049256887362, 0.4014620296211744, -0.17334226415731058, -0.6421275458983868, -1.6368884826987147, -1.1613437854550646, -0.05441580640312749, -1.0696435825989141, 0.9298956209832361, -1.2978569003227909, -0.944113252792969, 0.32947714652102533, 1.2673836552609883, -0.37137707407424125, -0.6383335006183137, 0.5209678182221662, -0.2233232987505076, 0.5523220126514947, -0.12508566774509156, 0.22473099455549672, 1.6953751043473786, -0.8541941242360447, -1.255252764450292, -0.9197831254439017, -1.1961697507929543, -1.693787330257289, -1.7874223891662644, 0.3072188634006321, 1.0167459517541948, -0.7697621281621205, 1.3244443522044302, -0.6117946609879787, 0.7933883225787728, -1.1800099330994955, -0.30086861043235347, 0.4596655927923843, 0.40551011085808275, -1.9225035606897776, -0.0673077549626826, -1.4897781882464978, -1.2991508710020776, -1.7671448006440826, 0.6708048299086382, -0.06008105760008409, 0.33389645066558726, -1.7254139168129567, 0.5054430414903042, 1.731522341878958, -1.1890752230545667, 1.06950836026542, -0.6930685318225867, 0.4776949127955312, 0.4467640334066667, -0.08012895870547876, -1.009275234480981, 1.7680418859429698, 1.8267652400828869, -0.02175355878113283, 0.18149741742657444, -0.2875097904101409, 1.3607923188219062, 0.805019974550532, -0.5581876993431543, 1.5014285799048714, -1.2710258017613478, -1.8502166242817508, 0.07289025436085073, 0.5666589092153482, -0.306947169259415, 1.451144721562137, 0.5218075265233906, -1.8678595607375268, 0.9526141332701563, -1.0662994718405039, -1.8110876356271084, 1.0081406806891544, 0.6242530411109408, -1.7833652463838896, -0.9772643267536276, 1.099376687742983, -0.16140465033904494, 1.884539840380258, -1.120725869955523, 1.0428486183663201, -0.506476031908468, 1.2865947116954377, 1.1152003699096293, -1.8698202208100732, -0.6413701542090564, 1.2931066267901357, -0.6884883735187084, -0.05688049089284686, 1.4412952952786253, 0.6200767626668902, -0.4243343521569569, 0.4895416893479845, 1.2240118031318965, -1.5314562661746556, 1.587302499854382, -0.6637200776839145, -1.9002843109616139, -1.7478753354042809, 0.3202764595546941, 1.2016769903247275, 0.07436567694155771, 1.4140000877889691, 0.21296258845536942, 0.5396591032630469, -0.7711263004266851, -1.8985908758498606, -1.8247131807153916, -1.117926836654267, -1.7527334554132348, 0.7567971760244916, 0.7195692238039308, 1.6827982655378761, 1.0833510712659273, -1.7652177984581674, 0.4923243899136276, -0.22729975787758905, -0.8065386426467236, 0.3414150736156172, 0.36352909695510727, 1.370775275714268, -1.262995153350694, -0.489711611653044, -1.6024482723979827};
const double J[] = {-0.711371112114473, 0.8664325533067561, -1.645194944178653, -0.11946201743115648, -0.2710763560735314, -1.4410388738271735, 1.461183071556034, -0.47732842767911166, 0.14409061512040733, 0.829008593899927, 0.36058053654889966, -0.5123200056107309, 1.9130566423511444, 1.364821444595019, -0.8900900013113997, -1.6184204343836845, 0.04357614480308314, -0.5967913107594369, 0.41389897325293745, 1.857369025571252, -1.771184204466517, 0.6728687675741121, -0.1950175780263046, -0.07786049210023194, -1.28186393111648, -0.663461669365141, -1.8396963535012838, -1.4687409330988825, 1.7030785470781389, -0.6076134103158006, -1.7118095273168281, 1.7406208023740706, -0.34844569590573693, -1.2377918005746418, 1.9308098553710646, -1.784616953987301, 0.6460032899019224, 0.3835588523740592, -0.5018391186264246, 1.5338558403156655, -1.2970339742509824, 0.9007537443113947, 0.9982094975473572, -1.5251243214227124, 0.09655945631879792, 0.007210299130742559, 1.9346958689623612, 1.9429651337904792, -1.2856653372060411, -0.0017433630966960934, 0.809821735416929, -0.3930092932097198, -0.006731701365751963, 0.8783873893829668, 1.8953927917779358, -1.739689259562307, 1.6695624334137533, 1.2302822825454354, 0.9651053009999462, 0.9884170835076604, 0.7410813531820164, -1.2280246596690052, -1.7163656692136335, -0.22924684930276928, -1.903306223051401, -0.39621863995069306, -1.413304973226155, -0.6190007838731066, 0.7595063537398166, -1.3114470816093915, 0.6305260545541898, -1.122618463326301, 1.0612980702591726, -0.36564289568996733, -0.4498456046996786, 0.21860195080299372, 0.9460072650329083, -1.7971994622196532, -1.9314852337411295, 1.0723145612359368, 0.10572462220509449, -1.5484602726577843, -1.6318815238516833, 1.023448440517234, 1.8763723920434434, -0.7969692766012102, 1.6202959652723918, 1.6309132556184096, 1.2064791013999385, 1.626280150734189, -0.011291923705501361, -1.671947134133596, -1.414489392793831, -0.040652224796699166, -1.8640797288056157, 0.12856695279908648, -0.3288430441669288, -1.0976960139798786, -0.170521599111356, -1.2785955263050721, 1.7788067009519422, -1.3033722100615863, -0.10748992633423393, 0.7964692778346008, -1.8715915534230643, 0.4064762782015512, 1.8282947772584346, 1.5468388656756518, -1.8201452193798682, -0.16373642778469266, 0.7956779824997509, 1.7090203934960462, -1.0070958104496022, 1.5028652484054779, -1.6622767800025775, 0.7865712775243714, 0.9581474690622991, -0.567356903211016, 1.7982299596028097, -1.5732712186829598, 1.942828424096645, 1.267735346500603, -0.8742474289935478, 1.410174174608707, -0.15271864770229726, 1.6321536715663054, 0.06729250915704243, 0.6564925890308864, 0.7467811081119113, 1.3684585002575758, -1.085916976767546, 0.19406987375593543, -1.3444261994715996, 0.1793604352706235, 1.321422521356245, 1.895631295660241, 1.0347747984809943, -1.6978390469223679, 1.6402023797063725, -0.17377332881591645, 0.5523879480578091, -0.5384083293948665, 1.6523662606592504, -1.956641604312658, -0.9678145212366642, 1.0103690202353754, 1.4293901412106322, 1.1673757042902957, 1.9165534357806306, -0.8160436638173927, -0.38768692943598104, 1.0268782758355957, 0.10040666472653337, -0.12831205707202464, -1.760833164001697, -1.5388192485777585, -1.758016940907424, 1.4763656578844953, 0.41832014137500595, -1.3995226452454839, -1.9614199665539638, -0.747742531777583, 1.0304324985270439, 0.6948344733515941, -0.540647395436527, 0.2252781903786314, 1.7215745999344958, -1.1181848489992654, 0.6730135727648454, 0.12622554077368342, -1.5588079847317293, -1.8331012346688929, -1.4997113746898743, 0.7884671843813398, 0.22393809379456941, -1.3884356645889007, 1.0580253857003132, -1.2618626366114496, -1.7048589534464869, -1.8029678993668998, 1.4208720466871165, -1.1448204690955834, -0.460606007474162, -1.1026782136581983, 1.9774310112251534, -1.3955618348076553, 0.8694213410133926, 1.9581271125367277, -1.2188069808059128, -0.4395927463211122, 1.0976725671591332, 0.17700932440284234, -1.544814066121166, 1.4357364984098626, 0.9121566510476158, -0.27704466483437695, 0.8659649132740355, -0.9848946678410289, 0.1474956346749523};

void CZ(qbit q1, qbit q2, double phi) {
    // printf("performing Controlled -2phi Z rotation\n");
    Rz(q2, -2.0*phi);
    CNOT(q1, q2);
    Rz(q2, phi);
    CNOT(q1, q2);
}

void ZcrossZ(qbit q1, qbit q2, double phi) {
    // printf("performing sigma_z cross sigma_z Hamiltonian\n");
    Rz(q1, phi);
    Rz(q2, -phi);
    CZ(q1, q2, -2.0*phi);
}


int main () {
    qbit reg[N];

    // Initialize all qubits to |+> state
    int n;
    for(n=0; n < N; n++) {
        PrepZ(reg[n], 0);
        H(reg[n]);
    }

    double T = 15;  // total duration of adiabatic evolution
    int M = 25;  // number of Trotter steps
    double dt = M / T;  // time per Trotter step

    int m;
    for(m = 1; m <= M; m++) {

        // Z-Z hamiltonian, executed in parallel
        for (n = 0; n < N-1; n += 2) {  // red pairs
            double phi = J[n] * (2.0*m - 1) / M;
            ZcrossZ(reg[n], reg[n + 1], phi);
        }
        for (n = 1; n < N-1; n += 2) {  // black pairs
            double phi = J[n] * (2.0*m - 1) / M;
            ZcrossZ(reg[n], reg[n + 1], phi);
        }

        double theta1 = (1.0 - (2.0*m-1)/M) * -2 * Bx * T / M;
        for (n = 0; n < N; n++) {
            H(reg[n]);
            Rz(reg[n], theta1);
            H(reg[n]);
        }

        // Bz hamiltonian
        for (n = 0; n < N; n++) {
            double theta2 = (1.0 - (2.0*m-1)/M) * -2 * Bz[n] * T / M;
            Rz(reg[n], theta2);
        }
    }


    for (n = 0; n < N; n++) {
        MeasZ(reg[0]);
    }

    return 0;
}
